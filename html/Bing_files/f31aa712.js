var ChangeType,SentenceCache;(function(n){n[n.ADD=0]="ADD";n[n.SUB=1]="SUB";n[n.REPLSUB=2]="REPLSUB";n[n.REPLADD=3]="REPLADD"})(ChangeType||(ChangeType={}));SentenceCache=function(){function n(){this.currentString=null;this.sentenceMapping=[];this.debug=!1}return n.prototype.getSentenceMapping=function(){return this.sentenceMapping},n.prototype.getCurrentString=function(){return this.currentString},n.prototype.isWhiteSpace=function(n){return n&&!n.trim()},n.prototype.updateSentenceMapping=function(n,t){for(var e,f,i=0;i<t.length;i++){var r=t[i][0]+n,u=t[i][1]+n,o=t[i][2],s=t[i][3];r<=u&&r<this.currentString.length&&u<this.currentString.length&&this.currentString.substring(r,u+1)===o&&this.sentenceMapping.push([r,u,o,s])}for(this.sentenceMapping=this.sortSentenceMapping(this.sentenceMapping),e=[],f=0;f<this.sentenceMapping.length;f++)e.push(this.sentenceMapping[f][3]);return e.join("")},n.prototype.reverse=function(n){return n.split("").reverse().join("")},n.prototype.getPrefix=function(n,t){for(var r="",u=Math.min(n.length,t.length),i=0;i<u;i++)if(n.charAt(i)==t.charAt(i))r+=n.charAt(i);else break;return r},n.prototype.getSuffix=function(n,t){return this.reverse(this.getPrefix(this.reverse(n),this.reverse(t)))},n.prototype.getChangedSegment=function(n){var i=this.getPrefix(this.currentString,n),r=this.getSuffix(this.currentString.substring(i.length),n.substring(i.length)),t;return t=n.length>=this.currentString.length?[ChangeType.ADD,n.substring(i.length,n.length-r.length)]:[ChangeType.SUB,this.currentString.substring(i.length,this.currentString.length-r.length)],t[0]==ChangeType.ADD&&t[1].length+this.currentString.length!=n.length&&(t[0]=ChangeType.REPLADD),t[0]==ChangeType.SUB&&t[1].length+n.length!=this.currentString.length&&(t[0]=ChangeType.REPLSUB),[i,t,r]},n.prototype.sortSentenceMapping=function(n){return n.sort(function(n,t){return n[0]-t[0]})},n.prototype.updateText=function(n){var u,i,h,v,y,f,c;if(this.currentString==null&&(this.currentString=""),this.currentString==n)return[n.length,""];var e=this.getChangedSegment(n),l=e[0],r=e[1],o=e[2];if(r[0]==ChangeType.REPLADD||r[0]==ChangeType.REPLSUB)return this.currentString=n,this.sentenceMapping=[],[0,this.currentString];var t=[],p=l.length,w=n.length-o.length;for(i=0;i<this.sentenceMapping.length;i++){var b=this.sentenceMapping[i][0],a=this.sentenceMapping[i][1],k=this.sentenceMapping[i][2],d=this.sentenceMapping[i][3];if(a>=p)break;t.push(this.sentenceMapping[i])}for(o.length==0&&r[0]==ChangeType.ADD&&t.length>0&&(this.isWhiteSpace(r[1])?(t[t.length-1][1]+=r[1].length,t[t.length-1][2]+=r[1],t[t.length-1][3]+=r[1],r[1]=""):t=t.slice(0,t.length-1)),u=[],i=this.sentenceMapping.length-1;i>=0;i--){var b=this.sentenceMapping[i][0],a=this.sentenceMapping[i][1],k=this.sentenceMapping[i][2],d=this.sentenceMapping[i][3],s=0;if(s=r[0]==ChangeType.ADD?r[1].length:-1*r[1].length,h=b+s,v=a+s,h<w)break;u.push([h,v,k,d])}return u.length>0&&(u=u.slice(0,u.length-1)),y=t.concat(u),this.sentenceMapping=this.sortSentenceMapping(y),t.length==0&&u.length==0&&(this.sentenceMapping=[]),l.length==0&&o.length==0&&(this.sentenceMapping=[]),this.currentString=n,f=-1,c=n.length,t.length>0&&(f=t[t.length-1][1]),u.length>0&&(c=u[u.length-1][0]),[f+1,n.substring(f+1,c)]},n}()